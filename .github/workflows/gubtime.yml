name: Print Hello, Secret, and Curl Websites  # Name of the GitHub Action

on: [push]  # Trigger the action on push events

jobs:
  print-hello-secret-curl-websites:
    runs-on: ubuntu-latest  # Use the latest version of Ubuntu as the runner

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2
      
    - name: Execute Script and Save Output
      id: script-output
      run: |
        #!/bin/bash

        # Define the YAML string
        yaml_string="urls:
          - Entry: 
            url: https://example.com
            alias: Example
            description: Example website
          - Entry: 
            url: https://google.com
            alias: Example
            description: Example website
          - Entry: 
            url: https://nonexistentwebsite.noway
            alias: Another Example
            description: Another example website"

        # Initialize string to hold output
        output=""

        # Print timestamp
        timestamp=$(date -u +"%Y-%m-%dT%H:%M:%S.%NZ")
        output+="timestamp: $timestamp"$'\n'

        # Parse YAML string and check responses
        while IFS= read -r line; do
            if [[ "$line" =~ ^\ +url:\ (.*) ]]; then
                url="${BASH_REMATCH[1]}"
            elif [[ "$line" =~ ^\ +alias:\ (.*) ]]; then
                alias="${BASH_REMATCH[1]}"
            elif [[ "$line" =~ ^\ +description:\ (.*) ]]; then
                description="${BASH_REMATCH[1]}"
                http_status=$(curl -s -o /dev/null -w "%{http_code}" "$url")
                output+="- alias: $alias"$'\n'
                output+="  description: $description"$'\n'
                output+="  response: $http_status"$'\n'
            fi
        done <<< "$yaml_string"

        # Print collected output
        echo "$output"



        echo "$output"
